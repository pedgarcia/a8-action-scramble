;------------------------------------------------------------------------------
; VBLANK PROCEDURE CALLED ONCE PER FRAME
;------------------------------------------------------------------------------

PROC VBLANKD=*()
  [PUSHAXYONSTACK]
  IF HSCROLI=$B THEN
    IF LMS=STARTSCREEN+LOOP+4 THEN
      DRAWLINE()
      NEXTROW=0 SCREENI=STARTROW LMS=STARTSCREEN
    ELSE
      LMS==+1 SCREENI==+1
    FI
    HSCROLI=$F
  FI
  HSCROL=HSCROLI HSCROLI==-1
  [PULLAXYFROMSTACK]
[JMPI OLDVBL]
